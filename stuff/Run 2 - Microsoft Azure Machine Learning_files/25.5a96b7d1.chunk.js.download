(this["webpackJsonp@mlworkspace/portal"]=this["webpackJsonp@mlworkspace/portal"]||[]).push([[25],{"6czz":function(e,t,r){"use strict";function a(e){return"string"===typeof e.webkitRelativePath}r.d(t,"a",(function(){return a}))},"lq+z":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return n})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return i})),r.d(t,"c",(function(){return D}));var a,n,s,i,o=r("zygG"),c=r("2h71"),u=r("Czhu"),p=r("VtSi"),l=r.n(p),d=r("fGyu"),f=r("QsI/"),m=r("9fIP"),h=r("MMYH"),b=r("PRnZ"),v=r("sRHE"),x=r("8K1b"),g=r("AqVP"),y=r("f2Ik"),k=r("io3C"),w=r("1V2x"),C=r.n(w),M=r("wgY5"),O=r.n(M),E=r("UcqZ"),I=r.n(E),S=r("yiDG"),T=r("6czz"),N=r("UCt/"),j=r("l1iB"),A=r("67aH"),F=function(e){Object(x.a)(r,e);var t=Object(g.a)(r);function r(e,a){var n;return Object(m.a)(this,r),(n=t.call(this,e,{retryCount:3})).wContext=void 0,n.wContext=a,n}return Object(h.a)(r,[{key:"deleteArtifactContainerContents",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch("DELETE",{baseUrl:this.wContext.discoveryUrls.experimentation,path:"/artifact/v2.0/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.MachineLearningServices/workspaces/{workspaceName}/data/{origin}/{container}",parameters:{subscriptionId:this.wContext.subscriptionId,resourceGroupName:this.wContext.resourceGroupName,workspaceName:this.wContext.workspaceName,origin:t,container:r}},j.a.DeleteArtifact));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uploadArtifactContent",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a,n){var s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="".concat(t,"/").concat(r,"/").concat(a),e.next=3,this.fetch("POST",{baseUrl:this.wContext.discoveryUrls.experimentation,path:"/artifact/v2.0/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.MachineLearningServices/workspaces/{workspaceName}/artifacts/content/{artifactId}",parameters:{subscriptionId:this.wContext.subscriptionId,resourceGroupName:this.wContext.resourceGroupName,workspaceName:this.wContext.workspaceName,artifactId:s},queryParameters:"allowOverwrite=true"},j.a.ArtifactUploadContent,n);case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()}]),r}(r("nRyU").a),R=r("CkWz"),U=r("lSvA"),P=r("oVcu"),G=r("/1N3");!function(e){e.New="new",e.Replace="replace"}(a||(a={})),function(e){e.CustomFiles="custom",e.EnvironmentReference="environment"}(n||(n={})),function(e){e[e.UploadFiles=0]="UploadFiles",e[e.RegisterModel=1]="RegisterModel"}(s||(s={})),function(e){e[e.Primary=0]="Primary",e[e.Secondary=1]="Secondary"}(i||(i={}));var D=function(e){Object(x.a)(r,e);var t=Object(g.a)(r);function r(e,a,n,s){var i;return Object(m.a)(this,r),(i=t.call(this,e,n)).wContext=void 0,i.artifactOrigin="WebUpload",i.baseImage="mcr.microsoft.com/azureml/base:intelmpi2018.3-ubuntu16.04",i.artifactFetchClient=void 0,i.artifactClient=void 0,i.storageAccountClient=void 0,i.userErrorStatusCodes=[401,404,409],i.userErrorErrorCodes=["REQUEST_SEND_XhrHttp_Error","REQUEST_SEND_Aborted","REQUEST_SEND_Retry_Error","REQUEST_SEND_Timeout","REQUEST_SEND_Deserialize_Error"],i.wContext=a,i.artifactFetchClient=new F(e,a),i.artifactClient=new R.a(e,a,s),i.storageAccountClient=new U.a(e),i}return Object(h.a)(r,[{key:"isUserError",value:function(e,t){var r=e||0,a=t||"";return this.userErrorStatusCodes.includes(r)||this.userErrorErrorCodes.includes(a)}},{key:"abort",value:function(){Object(b.a)(Object(v.a)(r.prototype),"abort",this).call(this),this.artifactClient.abort(),this.artifactFetchClient.abort(),this.storageAccountClient.abort()}},{key:"getModels",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a,n){var s,i,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="ModelList",t||this.clearCacheValue(s),i=function(){var e=Object(f.a)(l.a.mark((function e(){var t,s,i,c,u,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getModelClient();case 2:t=e.sent,s=a||1e3,i=[];case 5:return e.next=7,t.mLModels.listQuery(o.wContext.subscriptionId,o.wContext.resourceGroupName,o.wContext.workspaceName,{abortSignal:o.abortSignal,runId:r,skipToken:c,count:150,orderBy:"UpdatedAtDesc",datasetId:n});case 7:(u=e.sent)&&(i=i.concat(Object(d.a)(u))),p=u.nextLink,c=o.getSkipToken(p);case 11:if(c&&i.length<=s){e.next=5;break}case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(i,j.a.ModelList,s));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"getPaginatedModels",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a,n,s,i,o){var c,u,p,d,m=this,h=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=h.length>7&&void 0!==h[7]?h[7]:150,u=h.length>8?h[8]:void 0,p="ModelListPaginated",t||this.clearCacheValue(p),d=function(){var e=Object(f.a)(l.a.mark((function e(){var t,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.getModelClient();case 2:return t=e.sent,p={models:[]},e.next=6,t.mLModels.listQuery(m.wContext.subscriptionId,m.wContext.resourceGroupName,m.wContext.workspaceName,{abortSignal:m.abortSignal,runId:r,skipToken:u,count:c,orderBy:"UpdatedAtDesc",tags:n,name:a,datasetId:s,properties:i,version:o});case 6:return(d=e.sent)&&(p.models=d||[],p.continuationToken=m.getSkipToken(d.nextLink)),e.abrupt("return",p);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(d,j.a.ModelList,p));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,s,i,o){return e.apply(this,arguments)}}()},{key:"getModelDetails",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="ModelDetails",r||this.clearCacheValue(a,t),n=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.mLModels.queryById(s.wContext.subscriptionId,s.wContext.resourceGroupName,s.wContext.workspaceName,t,{abortSignal:s.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(n,j.a.ModelDetails,a,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDeployments",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a){var n,s,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="DeploymentsList",t||this.clearCacheValue(n,r),s=function(){var e=Object(f.a)(l.a.mark((function e(){var t,n,s,o,c,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.getModelClient();case 2:t=e.sent,n=a||1e3,s=[];case 5:return e.next=7,t.services.listQuery(i.wContext.subscriptionId,i.wContext.resourceGroupName,i.wContext.workspaceName,{abortSignal:i.abortSignal,modelId:r,skipToken:o,count:150,orderby:"UpdatedAtDesc"});case 7:(c=e.sent)&&(s=s.concat(Object(d.a)(c))),u=c.nextLink,o=i.getSkipToken(u);case 11:if(o&&s.length<=n){e.next=5;break}case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(s,j.a.Deployments,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"getPaginatedDeployments",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,s,i,o,c=this,p=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>2&&void 0!==p[2]?p[2]:150,n=p.length>3?p[3]:void 0,s=p.length>4?p[4]:void 0,i="DeploymentsListPaginated",t||this.clearCacheValue(i,r),o=function(){var e=Object(f.a)(l.a.mark((function e(){var t,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.getModelClient();case 2:return t=e.sent,i={deployments:[]},e.next=6,t.services.listQuery(c.wContext.subscriptionId,c.wContext.resourceGroupName,c.wContext.workspaceName,Object(u.a)(Object(u.a)({orderby:"UpdatedAtDesc"},s),{},{abortSignal:c.abortSignal,modelId:r,skipToken:n,count:a}));case 6:return(o=e.sent)&&(i.deployments=o||[],i.continuationToken=c.getSkipToken(o.nextLink)),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(o,j.a.Deployments,i,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDeploymentDetails",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="DeploymentDetails",r||this.clearCacheValue(a,t),n=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.services.queryById(s.wContext.subscriptionId,s.wContext.resourceGroupName,s.wContext.workspaceName,t,{abortSignal:s.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(n,j.a.DeploymentDetails,a,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteDeployment",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.services.deleteMethod(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,t,{abortSignal:a.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.DeleteDeployment));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validateServiceName",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.services.validation(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,t,{abortSignal:a.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.Validation));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validateServiceResources",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:return r=e.sent,n="AKS"===t.computeType?a.generateAKSValidationPayload(t):a.generateACIValidationPayload(t),e.abrupt("return",r.services.validation1(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,n,{abortSignal:a.abortSignal}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.Validation));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createAsset",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.assets.create(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,t,{abortSignal:a.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.CreateAsset));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDeploymentLogs",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a){var n,s,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="DeploymentLogs",r||this.clearCacheValue(n,t),s=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.services.getLogs(i.wContext.subscriptionId,i.wContext.resourceGroupName,i.wContext.workspaceName,t,{abortSignal:i.abortSignal,tail:a}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(s,j.a.GetServiceLogs,n,t));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"deployModel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deployModelWithStorageClient(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerAndDeployModel",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:r.name,description:r.description,artifacts:[{prefix:r.artifact}]},e.next=3,this.createAsset(a);case 3:if((n=e.sent).status!==A.a.Ok||!n.data){e.next=18;break}return s=n.data,i={name:r.name,description:r.description,mimeType:r.mimeType||"application/json",url:"aml://asset/".concat(s.id),framework:r.framework,frameworkVersion:r.frameworkVersion,experimentName:r.experimentName,runId:r.runId,datasets:r.datasets},e.next=9,this.registerModel(i);case 9:if((o=e.sent).status!==A.a.Ok||!o.data||!o.data.id){e.next=15;break}return t.modelIds=[o.data.id],e.abrupt("return",this.deployModel(t));case 15:return e.abrupt("return",{status:o.status,errorMessage:o.errorMessage});case 16:e.next=19;break;case 18:return e.abrupt("return",{status:n.status,errorMessage:n.errorMessage});case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uploadModel",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,i,o,c,u,p,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.generateContainerName(),t.file instanceof FileList?(n=Array.from(t.file).map((function(e){return{path:Object(T.a)(e)&&e.webkitRelativePath||e.name,file:e}})),i="".concat(this.artifactOrigin,"/").concat(a,"/").concat(n[0].path.split("/")[0])):(n=[{path:t.file.name,file:t.file}],i="".concat(this.artifactOrigin,"/").concat(a,"/").concat(n[0].path)),e.next=4,this.uploadModelArtifactsWithStorageClient(a,n,r);case 4:if((o=e.sent).status===A.a.Ok){e.next=7;break}return e.abrupt("return",o);case 7:return r({stage:s.RegisterModel,fileCount:n.length,fileIndex:n.length,currentFileSize:0,currentFileUploaded:0}),c={name:t.name,description:t.description,artifacts:[{prefix:i}]},e.next=11,this.createAsset(c);case 11:if((u=e.sent).status!==A.a.Ok||!u.data){e.next=18;break}return p=u.data,d={name:t.name,description:t.description,mimeType:n[0].file.type||"application/json",url:"aml://asset/".concat(p.id),framework:t.framework,frameworkVersion:t.frameworkVersion,unpack:t.unpack,kvTags:t.tags,properties:t.properties},e.abrupt("return",this.registerModel(d));case 18:return e.abrupt("return",{status:u.status,errorMessage:u.errorMessage});case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"registerModel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.mLModels.register(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,t,{abortSignal:a.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.RegisterModel));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateModel",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=Object(f.a)(l.a.mark((function e(){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getModelClient();case 2:return a=e.sent,e.abrupt("return",a.mLModels.patch(n.wContext.subscriptionId,n.wContext.resourceGroupName,n.wContext.workspaceName,t,[{op:"replace",path:"/kvTags",value:r.tags},{op:"replace",path:"/description",value:r.description}]));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(a,j.a.UpdateModel));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteModel",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:return r=e.sent,e.abrupt("return",r.mLModels.deleteMethod(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,t,{abortSignal:a.abortSignal}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.DeleteModel));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssetsByName",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a,n,s=this,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(i.length>1&&void 0!==i[1])||i[1],a="ModelAssetsList",r||this.clearCacheValue(a),n=function(){var e=Object(f.a)(l.a.mark((function e(){var r,a,n,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getModelClient();case 2:r=e.sent,a=[];case 4:return e.next=6,r.assets.listQuery(s.wContext.subscriptionId,s.wContext.resourceGroupName,s.wContext.workspaceName,{skipToken:n,count:200,name:t});case 6:(i=e.sent)&&(a=a.concat(Object(d.a)(i))),o=i.nextLink,n=s.getSkipToken(o);case 10:if(n){e.next=4;break}case 11:return e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(n,j.a.ModelAssetsList,a));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssetsByRunId",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){var e=Object(f.a)(l.a.mark((function e(){var r,n,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getModelClient();case 2:r=e.sent,n=[];case 4:return e.next=6,r.assets.listQuery(a.wContext.subscriptionId,a.wContext.resourceGroupName,a.wContext.workspaceName,{skipToken:s,count:200,runId:t});case 6:(i=e.sent)&&(n=n.concat(Object(d.a)(i))),o=i.nextLink,s=a.getSkipToken(o);case 10:if(s){e.next=4;break}case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(r,j.a.ModelAssetsListByRunId));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssetsByRunIdAndName",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=Object(f.a)(l.a.mark((function e(){var a,s,i,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getModelClient();case 2:a=e.sent,s=[];case 4:return e.next=6,a.assets.listQuery(n.wContext.subscriptionId,n.wContext.resourceGroupName,n.wContext.workspaceName,{skipToken:i,count:200,runId:t,name:r});case 6:(o=e.sent)&&(s=s.concat(Object(d.a)(o))),c=o.nextLink,i=n.getSkipToken(c);case 10:if(i){e.next=4;break}case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(a,j.a.ModelAssetsListByRunId));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getAssetsByTypeAndProperties",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a,n){var s,i,o,c=this,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=!(u.length>4&&void 0!==u[4])||u[4],i="ModelAssetsByPropertiesList",s||this.clearCacheValue(i),o=function(){var e=Object(f.a)(l.a.mark((function e(){var s,i,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.getModelClient();case 2:return s=e.sent,i=n||150,o={assets:[]},e.next=7,s.assets.listQuery(c.wContext.subscriptionId,c.wContext.resourceGroupName,c.wContext.workspaceName,{assetType:t,properties:r,abortSignal:c.abortSignal,skipToken:a,count:i,orderBy:"UpdatedAtDesc"});case 7:return(u=e.sent)&&(o.assets=u||[],o.continuationToken=c.getSkipToken(u.nextLink)),e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(o,j.a.ModelAssetsList,i));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n){return e.apply(this,arguments)}}()},{key:"getAsset",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getModelClient();case 2:return r=e.sent,a=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.assets.queryById(n.wContext.subscriptionId,n.wContext.resourceGroupName,n.wContext.workspaceName,t,{abortSignal:n.abortSignal}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(a,j.a.ModelAsset));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getModelArtifactsDownloadLinks",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a,n,s,i,o,u,p,d,m,h,b,v,x,g,y,k=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=/^aml:\/\/asset\/(.+)$/.exec(t.url))&&2===r.length){e.next=4;break}return e.abrupt("return",{status:A.a.Ok,data:[]});case 4:return e.next=6,this.getAsset(r[1]);case 6:if((a=e.sent).status!==A.a.Ok||!a.data){e.next=35;break}if(n=a.data,s=[],!n.artifacts){e.next=32;break}i=[],o=Object(c.a)(n.artifacts);try{for(p=function(){var e=u.value,t=k.getPartsFromArtifactIdOrPrefix(e.id||e.prefix);if(t){var r=I()().waitAndRetry(3).executeForPromise(Object(f.a)(l.a.mark((function e(){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.artifactClient.getArtifactDownloadUrlsByPrefix(t.origin,t.container,t.path);case 2:if((r=e.sent).status!==A.a.Ok||!r.data){e.next=7;break}return e.abrupt("return",r.data);case 7:return e.abrupt("return",Promise.reject({status:r.status,errorMessage:r.errorMessage}));case 8:case"end":return e.stop()}}),e)}))));i.push({promise:r,parts:t})}},o.s();!(u=o.n()).done;)p()}catch(w){o.e(w)}finally{o.f()}e.prev=14,d=0,m=i;case 16:if(!(d<m.length)){e.next=27;break}return h=m[d],b=h.promise,v=h.parts,e.t0=c.a,e.next=21,b;case 21:e.t1=e.sent,x=(0,e.t0)(e.t1);try{for(x.s();!(g=x.n()).done;)y=g.value,s.push({sasUrl:y,parts:v})}catch(w){x.e(w)}finally{x.f()}case 24:d++,e.next=16;break;case 27:e.next=32;break;case 29:return e.prev=29,e.t2=e.catch(14),e.abrupt("return",e.t2);case 32:return e.abrupt("return",{status:A.a.Ok,data:s});case 35:return e.abrupt("return",{status:a.status,errorMessage:a.errorMessage});case 36:case"end":return e.stop()}}),e,this,[[14,29]])})));return function(t){return e.apply(this,arguments)}}()},{key:"listServiceKeys",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,s,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="ListServiceKeys",e.next=3,this.getModelClient();case 3:return n=e.sent,r||this.clearCacheValue(a,t),s=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.services.listServiceKeys(i.wContext.subscriptionId,i.wContext.resourceGroupName,i.wContext.workspaceName,t,{abortSignal:i.abortSignal}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.executeWithCache(s,j.a.ListServiceKeys,a,t));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"regenerateServiceKeys",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r){var a,n,s,i,o,c,u,p,d,m=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getModelClient();case 2:return a=e.sent,n=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.services.regenerateServiceKeys(m.wContext.subscriptionId,m.wContext.resourceGroupName,m.wContext.workspaceName,t,r,{abortSignal:m.abortSignal}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=6,this.execute(n,j.a.RegenerateServiceKeys);case 6:if((s=e.sent)&&s.data){e.next=9;break}return e.abrupt("return",{status:A.a.Error,data:{primaryKey:void 0,secondaryKey:void 0}});case 9:if(i=this.parseOperationIdFromLocation(s.data._response.headers.get("Operation-Location"))){e.next=12;break}return e.abrupt("return",{status:A.a.Error,data:{primaryKey:void 0,secondaryKey:void 0}});case 12:return e.next=14,this.waitForCompletion(i);case 14:if("Succeeded"===e.sent){e.next=17;break}return e.abrupt("return",{status:A.a.Error,data:{primaryKey:void 0,secondaryKey:void 0}});case 17:return e.next=19,this.listServiceKeys(t,!1);case 19:return o=e.sent,e.next=22,o.serviceResponses.toPromise();case 22:return c=e.sent,u=c.data||{primaryKey:void 0,secondaryKey:void 0},p=u.primaryKey,d=u.secondaryKey,e.abrupt("return",{status:c.status,errorMessage:c.errorMessage,errorResponse:c.errorResponse,errorRequest:c.errorRequest,data:{primaryKey:p,secondaryKey:d}});case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"parseOperationIdFromLocation",value:function(e){if(e){var t=new RegExp("\\/operations\\/([a-f0-9\\-]{36})").exec(e);if(t&&!(t.length<=1))return t[1]}}},{key:"waitForCompletion",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a,n,s,i,o,c,u,p=this,d=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>1&&void 0!==d[1]?d[1]:1e3,a=d.length>2&&void 0!==d[2]?d[2]:3e4,e.next=4,this.getModelClient();case 4:n=e.sent,s="Failed",i=a/r,o=0;case 8:if(!(o<i)){e.next=23;break}return c=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.operations.get(p.wContext.subscriptionId,p.wContext.resourceGroupName,p.wContext.workspaceName,t,{abortSignal:p.abortSignal}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=12,this.execute(c,j.a.GetOperation);case 12:if((u=e.sent)&&u.data){e.next=15;break}return e.abrupt("return",s);case 15:if("Running"===(s=u.data.state||"Failed")){e.next=18;break}return e.abrupt("return",s);case 18:return e.next=20,new Promise((function(e){return setTimeout((function(){e(r)}),r)}));case 20:o++,e.next=8;break;case 23:return e.abrupt("return","TimedOut");case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPartsFromArtifactIdOrPrefix",value:function(e){if(e){var t=/^(.+?)\/(.+?)\/(.+?)(?:\?.*)?$/.exec(e);if(t&&4===t.length)return{origin:t[1],container:t[2],path:t[3]}}}},{key:"deployModelWithStorageClient",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r,a,n,s,i,o,p,d,m,h,b,v,x,g,k,w,M,O,E,I,T=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.generateContainerName(),e.next=3,this.getTokenCredentials();case 3:if(n=e.sent,s=new y.a(n,Object(u.a)(Object(u.a)({},this.serviceClientOptions),{},{baseUri:this.wContext.discoveryUrls.experimentation})),!t.driverProgram){e.next=44;break}return a=a||[],i=[{path:t.driverProgram.name}],e.prev=8,p={body:{paths:i}},e.next=12,s.artifacts.batchCreateEmptyArtifacts(this.wContext.subscriptionId,this.wContext.resourceGroupName,this.wContext.workspaceName,this.artifactOrigin,r,p);case 12:o=e.sent,e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(8),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:e.t0.message}});case 18:if(!o||!o.artifactContentInformation){e.next=41;break}if(!(m=o.artifactContentInformation[t.driverProgram.name].contentUri)){e.next=32;break}return e.prev=21,e.next=24,this.storageAccountClient.uploadFile(m,t.driverProgram);case 24:d=e.sent,e.next=30;break;case 27:return e.prev=27,e.t1=e.catch(21),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:e.t1.message}});case 30:e.next=33;break;case 32:return e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:this.createEmptyArtifactErrorMessage(i,o)}});case 33:if(201!==d._response.status||!o.artifacts){e.next=38;break}(a=a||[]).push({id:t.driverProgram.name,mimeType:t.driverProgram.type||"application/x-python",url:"aml://artifact/".concat(o.artifacts[t.driverProgram.name].artifactId)}),e.next=39;break;case 38:return e.abrupt("return",{status:d._response.status,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:this.createStorageErrorMessage(t.driverProgram.name,d)}});case 39:e.next=42;break;case 41:return e.abrupt("return",{status:o._response.status,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToGetSasUrl.Title,message:this.createEmptyArtifactErrorMessage(i,o)}});case 42:e.next=45;break;case 44:t.scoringFileArtifactId&&t.scoringFileArtifactName&&(a=a||[]).push({id:t.scoringFileArtifactName,mimeType:"application/x-python",url:"aml://artifact/".concat(t.scoringFileArtifactId)});case 45:if(!(t.dependencies&&t.dependencies.length>0)){e.next=97;break}a=a||[],h=Object(c.a)(t.dependencies),e.prev=48,h.s();case 50:if((b=h.n()).done){e.next=89;break}return v=b.value,x=void 0,e.prev=53,e.next=56,s.artifacts.batchCreateEmptyArtifacts(this.wContext.subscriptionId,this.wContext.resourceGroupName,this.wContext.workspaceName,this.artifactOrigin,r,{body:{paths:[{path:v.name}]}});case 56:x=e.sent,e.next=62;break;case 59:return e.prev=59,e.t2=e.catch(53),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:e.t2.message}});case 62:if(!x.artifactContentInformation){e.next=86;break}if(g=void 0,!(k=x.artifactContentInformation[v.name].contentUri)){e.next=77;break}return e.prev=66,e.next=69,this.storageAccountClient.uploadFile(k,v);case 69:g=e.sent,e.next=75;break;case 72:return e.prev=72,e.t3=e.catch(66),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:e.t3.message}});case 75:e.next=78;break;case 77:return e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:this.createEmptyArtifactErrorMessage([{path:v.name}],x)}});case 78:if(201!==g._response.status||!x.artifacts){e.next=83;break}(a=a||[]).push({id:v.name,mimeType:v.type||"application/x-python",url:"aml://artifact/".concat(x.artifacts[v.name].artifactId)}),e.next=84;break;case 83:return e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:this.createStorageErrorMessage(v.name,g)}});case 84:e.next=87;break;case 86:return e.abrupt("return",{status:x._response.status,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToGetSasUrl.Title,message:this.createEmptyArtifactErrorMessage([{path:v.name}],x)}});case 87:e.next=50;break;case 89:e.next=94;break;case 91:e.prev=91,e.t4=e.catch(48),h.e(e.t4);case 94:return e.prev=94,h.f(),e.finish(94);case 97:if(!t.condaDependenciesFile){e.next=109;break}return e.next=100,this.readFileAsText(t.condaDependenciesFile);case 100:M=e.sent,w={},e.prev=102,w=C.a.safeLoad(M),e.next=109;break;case 106:return e.prev=106,e.t5=e.catch(102),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.InvalidYaml.Title,message:G.b.Core.InvalidYaml.Message}});case 109:if("AKS"!==t.computeType){e.next=113;break}e.t6=this.generateAKSDeploymentPayload(t,a,w),e.next=116;break;case 113:return e.next=115,this.generateACIDeploymentPayload(t,a,w);case 115:e.t6=e.sent;case 116:return O=e.t6,E=t.scenarioId?t.scenarioId:"",I=function(){var e=Object(f.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.getModelClient();case 2:return t=e.sent,e.abrupt("return",t.services.create(T.wContext.subscriptionId,T.wContext.resourceGroupName,T.wContext.workspaceName,O,{abortSignal:T.abortSignal,customHeaders:{"x-ms-scenario-id":E}}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",this.execute(I,j.a.DeployModel));case 120:case"end":return e.stop()}}),e,this,[[8,15],[21,27],[48,91,94,97],[53,59],[66,72],[102,106]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createEmptyArtifactErrorMessage",value:function(e,t){if(t.errors){var r,a="",n=Object(c.a)(e);try{for(n.s();!(r=n.n()).done;){var s=r.value,i=t.errors[s.path];i&&(a="".concat(a,"; ").concat(i))}}catch(o){n.e(o)}finally{n.f()}return Object(N.a)(G.b.Core.FailedToGetSasUrl.MessageWithErrors,{pathErrors:a})}return G.b.Core.FailedToGetSasUrl.MessageWithErrors}},{key:"createStorageErrorMessage",value:function(e,t){return t.errorCode?Object(N.a)(G.b.Core.FailedToUploadFile.MessageWithErrorCode,{errorCode:t.errorCode,fileName:e}):Object(N.a)(G.b.Core.FailedToUploadFile.MessageWithoutErrorCode,{fileName:e})}},{key:"generateContainerName",value:function(){var e=new Uint32Array(1);crypto.getRandomValues(e);var t=O()();return"".concat(t.format("YYMMDDHHmmss"),"-").concat(e[0])}},{key:"getSkipToken",value:function(e){if(e){var t=new URL(e).searchParams.get("$skipToken");if(t)return t}}},{key:"getModelClient",value:function(){var e=Object(f.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTokenCredentials();case 2:return t=e.sent,e.abrupt("return",new k.a(t,Object(u.a)(Object(u.a)({},this.serviceClientOptions),{},{baseUri:this.wContext.discoveryUrls.modelmanagement})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFileAsText",value:function(){var e=Object(f.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new FileReader,e.abrupt("return",new Promise((function(e,a){r.onerror=function(){r.abort(),a(new DOMException("Problem parsing input file."))},r.onload=function(){e(r.result)},r.readAsText(t,"utf8")})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"generateAKSDeploymentPayload",value:function(e,t,r){var a={name:e.name,properties:e.properties,computeType:"AKS",computeName:e.computeName,description:e.description,environmentImageRequest:this.generateEnvironmentImageRequest(e,t,r)};return this.addAdvanceAKSSettings(a,e),a}},{key:"addAdvanceAKSSettings",value:function(e,t){e.aadAuthEnabled=t.aadAuthEnabled,e.authEnabled=t.authEnabled,(t.primaryKey||t.secondaryKey)&&(e.keys={primaryKey:t.primaryKey,secondaryKey:t.secondaryKey}),e.appInsightsEnabled=t.appInsightsEnabled,t.dataCollection&&(e.dataCollection={eventHubEnabled:!0,storageEnabled:!0}),t.scoringTimeoutMs&&(e.scoringTimeoutMs=Number(t.scoringTimeoutMs)),t.autoscaleEnabled?e.autoScaler={autoscaleEnabled:t.autoscaleEnabled,maxReplicas:t.maxReplicas?Number(t.maxReplicas):void 0,minReplicas:t.minReplicas?Number(t.minReplicas):void 0,targetUtilization:t.targetUtilization?Number(t.targetUtilization):void 0,refreshPeriodInSeconds:t.refreshPeriodInSeconds?Number(t.refreshPeriodInSeconds):void 0}:e.numReplicas=t.numReplicas?Number(t.numReplicas):void 0,e.maxConcurrentRequestsPerContainer=t.maxConcurrentRequestsPerContainer?Number(t.maxConcurrentRequestsPerContainer):void 0,(t.cpu||t.memoryInGB)&&(e.containerResourceRequirements={cpu:t.cpu?Number(t.cpu):void 0,memoryInGB:t.memoryInGB?Number(t.memoryInGB):void 0})}},{key:"generateACIDeploymentPayload",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a){var n,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={name:t.name,properties:t.properties,computeType:"ACI",appInsightsEnabled:t.appInsightsEnabled,sslEnabled:t.sslEnabled,dnsNameLabel:t.dnsLabel,cname:t.cname,containerResourceRequirements:{cpu:t.cpu?Number(t.cpu):void 0,memoryInGB:t.memoryInGB?Number(t.memoryInGB):void 0},environmentImageRequest:this.generateEnvironmentImageRequest(t,r,a)},t.dataCollection&&(n.dataCollection={eventHubEnabled:!0,storageEnabled:!0}),n.authEnabled=t.authEnabled,(t.primaryKey||t.secondaryKey)&&(n.keys={primaryKey:t.primaryKey,secondaryKey:t.secondaryKey}),!t.sslCertificate||!t.sslKey){e.next=13;break}return e.next=7,this.readFileAsText(t.sslCertificate);case 7:return s=e.sent,e.next=10,this.readFileAsText(t.sslKey);case 10:i=e.sent,n.sslCertificate=s,n.sslKey=i;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,a){return e.apply(this,arguments)}}()},{key:"generateEnvironmentImageRequest",value:function(e,t,r){var a={modelIds:e.modelIds,assets:t};return e.driverProgram?a.driverProgram=e.driverProgram.name:e.scoringFileArtifactId&&e.scoringFileArtifactName&&(a.driverProgram=e.scoringFileArtifactName),r&&(a.environment={name:"".concat(e.name,"-env"),python:{userManagedDependencies:!1,interpreterPath:"python",condaDependencies:r},docker:{baseImage:this.baseImage}}),e.environmentReference&&(a.environmentReference=e.environmentReference),a}},{key:"generateAKSValidationPayload",value:function(e){var t={autoscaleEnabled:e.autoscaleEnabled,minReplicas:e.minReplicas,maxReplicas:e.maxReplicas,targetUtilization:e.targetUtilization,refreshPeriodInSeconds:e.refreshPeriodInSeconds},r={cpu:e.cpu,memoryInGB:e.memoryInGB};return{computeType:"AKS",name:e.name,computeName:e.computeName,numReplicas:e.numReplicas,containerResourceRequirements:r,autoScaler:t}}},{key:"generateACIValidationPayload",value:function(e){var t={cpu:e.cpu,memoryInGB:e.memoryInGB};return{computeType:"ACI",name:e.name,containerResourceRequirements:t}}},{key:"uploadModelArtifactsWithStorageClient",value:function(){var e=Object(f.a)(l.a.mark((function e(t,r,a){var n,i,c,p,d,f,m,h,b,v,x,g,k,w,C,M,O,E;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTokenCredentials();case 2:for(n=e.sent,i=new y.a(n,Object(u.a)(Object(u.a)({},this.serviceClientOptions),{},{baseUri:this.wContext.discoveryUrls.experimentation})),c=[],p=0,d=Array.from(r.entries());p<d.length;p++)f=Object(o.a)(d[p],2),f[0],m=f[1].path,c.push({path:m});return e.prev=6,e.next=9,i.artifacts.batchCreateEmptyArtifacts(this.wContext.subscriptionId,this.wContext.resourceGroupName,this.wContext.workspaceName,this.artifactOrigin,t,{body:{paths:c}});case 9:h=e.sent,e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:e.t0.message}});case 15:if(200!==h._response.status||!h.artifactContentInformation){e.next=45;break}b=0,v=Array.from(r.entries());case 17:if(!(b<v.length)){e.next=43;break}if(x=Object(o.a)(v[b],2),g=x[0],k=x[1],w=k.path,C=k.file,M={stage:s.UploadFiles,fileCount:r.length,fileIndex:g,currentFileSize:C.size,currentFileUploaded:0},a(M),O=void 0,!(E=h.artifactContentInformation[w].contentUri)){e.next=35;break}return e.prev=24,e.next=27,this.storageAccountClient.uploadFile(E,C);case 27:O=e.sent,e.next=33;break;case 30:return e.prev=30,e.t1=e.catch(24),e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:e.t1.message}});case 33:e.next=36;break;case 35:return e.abrupt("return",{status:A.a.Error,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:this.createEmptyArtifactErrorMessage([{path:C.name}],h)}});case 36:if(a(Object(u.a)(Object(u.a)({},M),{},{currentFileUploaded:C.size})),201===O._response.status){e.next=40;break}return this.artifactFetchClient.deleteArtifactContainerContents(this.artifactOrigin,t),e.abrupt("return",{status:O._response.status,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToUploadFile.Title,message:this.createStorageErrorMessage(w,O)}});case 40:b++,e.next=17;break;case 43:e.next=46;break;case 45:return e.abrupt("return",{status:h._response.status,errorMessage:{messageType:S.c.Error,title:G.b.Core.FailedToGetSasUrl.Title,message:this.createEmptyArtifactErrorMessage(c,h)}});case 46:return e.abrupt("return",{status:A.a.Ok});case 47:case"end":return e.stop()}}),e,this,[[6,12],[24,30]])})));return function(t,r,a){return e.apply(this,arguments)}}()}]),r}(P.a)}}]);
//# sourceMappingURL=25.5a96b7d1.chunk.js.map